# Design Decisions - Thought Loop

## アーキテクチャ設計

### 採用技術の選択理由

#### Backend: FastAPI
- **理由**: 高性能な非同期処理、自動ドキュメント生成、型安全性
- **代替案**: Flask, Django
- **選択理由**: 現代的なPython Webフレームワークで、OpenAI APIとの統合が容易

#### Frontend: Next.js
- **理由**: Reactベース、SSR対応、優れた開発体験
- **代替案**: React、Vue、Svelte
- **選択理由**: Pages Routerを使用したシンプルな構成で、拡張性が高い

#### Styling: Tailwind CSS
- **理由**: ユーティリティファースト、迅速な開発、カスタマイズ性
- **代替案**: CSS Modules, Styled Components, CSS-in-JS
- **選択理由**: UI構築が高速で、保守性が高い

### Docker構成

#### マルチコンテナアーキテクチャ
- **理由**: 開発環境と本番環境の一致、依存関係の分離
- **構成**: Backend + Frontend (現在) → 将来DBコンテナ追加予定
- **ボリューム**: ホットリロードのためにソースコードをマウント

#### ポート設定
- Backend: 8000 (FastAPI標準)
- Frontend: 3000 (Next.js標準)
- 理由: 開発者に馴染みのある標準ポート

## API設計

### エンドポイント

#### `POST /chat`
- **目的**: ユーザーメッセージを受け取り、AI応答を返す
- **リクエスト**: `{ "message": "string" }`
- **レスポンス**: `{ "reply": "string" }`
- **エラーハンドリング**: 例外をキャッチしてエラーメッセージを返す

### セキュリティ考慮事項

#### CORS
- 現在: すべてのオリジン許可（開発環境）
- 将来: 本番環境では特定のオリジンを許可

#### APIキー
- 環境変数で管理
- `.env`ファイルはGitに含めない（.gitignore）

## UI設計

### チャットインターフェース
- **レイアウト**: 中央揃え、最大幅2xl
- **カラー**: シンプルな白背景、青色のアクセント
- **入力**: Enterキーで送信可能
- **将来的な改善**: 思考ツリービジュアライゼーション

## 今後の拡張計画

1. **データ永続化**
   - SQLite ORMの実装
   - セッション管理

2. **思考ツリー**
   - D3.js / React-Flowを使用
   - 会話の構造を視覚化

3. **感情スコアリング**
   - OpenAI Function Callingを使用
   - 心理的変化の可視化

4. **Mirror機能**
   - 過去の思考との比較
   - 成長の可視化

